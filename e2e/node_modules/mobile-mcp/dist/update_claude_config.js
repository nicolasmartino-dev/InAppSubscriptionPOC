"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateClaudeConfig = updateClaudeConfig;
const node_path_1 = __importDefault(require("node:path"));
const node_os_1 = __importDefault(require("node:os"));
const promises_1 = __importDefault(require("fs/promises"));
const inquirer_1 = __importDefault(require("inquirer"));
function getClaudeConfigDir() {
    switch (node_os_1.default.platform()) {
        case "darwin":
            return node_path_1.default.join(node_os_1.default.homedir(), "Library", "Application Support", "Claude");
        case "win32":
            if (!process.env.APPDATA) {
                throw new Error("APPDATA environment variable is not set");
            }
            return node_path_1.default.join(process.env.APPDATA, "Claude");
        default:
            throw new Error(`Unsupported operating system for Claude configuration: ${node_os_1.default.platform()}`);
    }
}
async function updateClaudeConfig({ name, command, args }) {
    try {
        const configFile = node_path_1.default.join(getClaudeConfigDir(), "claude_desktop_config.json");
        let config;
        try {
            config = JSON.parse(await promises_1.default.readFile(configFile, "utf-8"));
        }
        catch (err) {
            if (err.code !== "ENOENT") {
                throw err;
            }
            // File doesn't exist, create initial config
            config = {};
            await promises_1.default.mkdir(node_path_1.default.dirname(configFile), { recursive: true });
        }
        if (!config.mcpServers) {
            config.mcpServers = {};
        }
        if (config.mcpServers[name]) {
            const { replace } = await inquirer_1.default.prompt([
                {
                    type: "confirm",
                    name: "replace",
                    message: `An MCP server named "${name}" is already configured for Claude.app. Do you want to replace it?`,
                    default: false,
                },
            ]);
            if (!replace) {
                console.log(`⚠️ Skipped replacing Claude.app config for existing MCP server "${name}"`);
                return;
            }
        }
        config.mcpServers[name] = {
            command,
            args,
        };
        await promises_1.default.writeFile(configFile, JSON.stringify(config, null, 2));
        console.log("✅ Successfully added MCP server to Claude.app configuration");
    }
    catch {
        console.log("⚠️ Note: Could not update Claude.app configuration");
    }
}
